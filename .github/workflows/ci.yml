name: CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  check-backend:
    name: Check no backend files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Ensure no backend.tf or backend/ files are committed
        run: |
          set -euo pipefail
          if git ls-files --error-unmatch backend.tf >/dev/null 2>&1 || git ls-files --error-unmatch "backend/*.tf" >/dev/null 2>&1; then
            echo 'ERROR: backend.tf or backend/*.tf found in repository. Remove them and add to .gitignore.'
            git ls-files --error-unmatch backend.tf 2>/dev/null || true
            git ls-files --error-unmatch "backend/*.tf" 2>/dev/null || true
            exit 1
          fi
  shellcheck:
    name: Shellcheck scripts
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Run shellcheck
        uses: ludeeus/action-shellcheck@v2
        with:
          files: |
            scripts/*.sh
            setup_oci_terraform.sh
          exclude: ''
          options: '-e SC2230 -e SC1090'
